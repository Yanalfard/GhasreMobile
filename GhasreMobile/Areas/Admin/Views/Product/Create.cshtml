@model DataLayer.Models.TblProduct
@{
    ViewData["Title"] = "افزودن محصول";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}
<link href="~/css/dropzone.css" rel="stylesheet" />
<div class="row flex-div">
    <div class="col-md-12 flex-div pb-3 pt-3">

        <form asp-action="Create" asp-controller="Product" asp-area="Admin" method="post" class="card flex-div border-0 main-shadow" enctype="multipart/form-data">
            @Html.AntiForgeryToken()
            <div class="card-body flex">
                <ul uk-accordion class="bg-light mt-3 pt-3 pb-3 uk-text-small uk-border-rounded">
                    <li class="col-md-4">
                        <a class="uk-accordion-title uk-text-small" href="#">دسته بندی</a>
                        <div class="uk-accordion-content">
                            <ul class="uk-margin-right" uk-accordion>
                                @{
                                    IEnumerable<DataLayer.Models.TblCatagory> Parentcatagories = ViewBag.Parentcatagories;
                                }
                                @foreach (var item in Parentcatagories)
                                {
                                    <li>
                                        @if (!item.IsOnFirstPage)
                                        {
                                            <a class="uk-accordion-title uk-text-small">@item.Name</a>
                                        }
                                        else
                                        {
                                            <a id="Cat-@item.CatagoryId" class="uk-accordion-title uk-text-small Cat" onclick="SelectCatagory(@item.CatagoryId)">@item.Name</a>
                                        }
                                        <div class="uk-accordion-content">
                                            <ul class="uk-margin-right" uk-accordion>
                                                @await Component.InvokeAsync("ShowChildsCatagoryInCreateProduct", new { Id = item.CatagoryId })
                                            </ul>
                                        </div>
                                    </li>
                                }
                            </ul>
                        </div>
                    </li>
                </ul>
                <input type="hidden" asp-for="CatagoryId" />
                <span id="CatagoryIdErorr" asp-validation-for="CatagoryId" class="text-danger"></span>
                <hr />
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <select asp-for="BrandId" class="form-control form-control-sm">
                            @{
                                IEnumerable<DataLayer.Models.TblBrand> Brands = ViewBag.Brands;
                            }
                            <option value="0">لطفا برند خود را مشخص کنید</option>
                            @foreach (var item in Brands)
                            {
                                <option value="@item.BrandId">@item.Name</option>
                            }
                        </select>
                        <input type="hidden" asp-for="BrandId" />
                        <span id="BrandIdErorr" asp-validation-for="BrandId" class="text-danger"></span>
                    </div>
                </div>
                <div class="form-row mt-3">
                    <div class="form-group col-md-3">
                        <label>نام محصول</label>
                        <input asp-for="Name" class="form-control form-control-sm" placeholder="مثال : شارژر">
                        <span asp-validation-for="Name" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label>قیمت</label>
                        <input asp-for="PriceBeforeDiscount" class="form-control form-control-sm" placeholder="مثال : 80000 تومان">
                        <span asp-validation-for="PriceBeforeDiscount" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label>درصد تخفیف</label>
                        <input asp-for="PriceAfterDiscount" maxlength="2" class="form-control form-control-sm" placeholder="مثال : 10">
                        <span asp-validation-for="PriceAfterDiscount" class="text-danger"></span>
                    </div>
                </div>
                <div class="custom-file col-md-7 mt-3">
                    <input asp-for="MainImage" type="file" class="custom-file-input form-control form-control-sm">
                    <label class="custom-file-label" for="Image" data-browse="انتخاب" id="FileName">انتخاب تصویر اصلی</label>
                </div>
                <span id="MainImageErorr" class="text-danger" asp-validation-for="MainImage"></span>
                <div class="form-row mt-3">
                    <div class="form-group col-md-3">
                        <label>متن جستجو</label>
                        <input asp-for="SearchText" class="form-control form-control-sm" placeholder="مثال : ...">
                        <span class="text-danger" asp-validation-for="SearchText"></span>
                    </div>
                    <div class=" col-md-2 mt-4 pt-3 mr-3">
                        <input asp-for="IsFractional" type="checkbox"> فروش اقساطی
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <input type="text" value="" data-role="tagsinput" id="tags" class="form-control" placeholder="کلمات کلیدی">
                    </div>
                    <span class="text-danger" asp-validation-for="TblProductKeywordRel"></span>
                </div>
                <hr />

                <label class="uk-text-bold">افزودن رنگ :</label>
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <label>انتخاب رنگ</label>
                        <input id="InputColor" type="color" class="form-control form-control-sm" />
                    </div>
                    <div class="form-group col-md-3">
                        <label>نام رنگ</label>
                        <input id="InputColorName" type="text" maxlength="50" placeholder="مثال : آبی" class="form-control form-control-sm" />
                    </div>
                    <div class="form-group col-md-3">
                        <label>تعداد</label>
                        <input id="InputColorCount" type="number" placeholder="مثال : 2" class="form-control form-control-sm" />
                    </div>
                    <div class="form-group col-md-2 mt-md-4 pt-2 text-white">
                        <a id="SubmitColor" class="btn btn-info btn-sm">افزودن</a>
                    </div>
                    <span id="TblColor" asp-validation-for="TblColor" class="text-danger"></span>
                </div>
                <aside id="ColorPanel">

                </aside>
                <hr />
                <div class="form-row mt-3">
                    <div class="form-group col-md-5">
                        <label class="uk-text-bold">افزودن ویژگی</label>
                        <input id="NewProperyName" class="form-control form-control-sm" placeholder="مثال : حافظه داخلی">
                        <span id="CreateNewProperyErorr" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2 mt-md-4 pt-2">
                        <a onclick="CreatePropery()" class="btn btn-info btn-sm text-white">افزودن</a>
                    </div>
                </div>
                <aside id="PropertyPanel">
                    @await Component.InvokeAsync("PropertyListAdmin")
                </aside>
                <hr />
                <div class="mt-3">
                    <label class="ml-5">توضیحات کوتاه :</label>
                    <textarea id="DescriptionShortHtml" asp-for="DescriptionShortHtml"></textarea>
                    <span class="text-danger" asp-validation-for="DescriptionShortHtml"></span>
                </div>
                <div class="mt-3">
                    <label class="ml-5">توضیحات کامل :</label>
                    <textarea id="DescriptionLongHtml" asp-for="DescriptionLongHtml" style="max-height:300px !important;"></textarea>
                    <span class="text-danger" asp-validation-for="DescriptionLongHtml"></span>
                </div>
                <hr />
                <label class="mt-3 uk-text-bold">افزودن عکس به گالری تصاویر</label>
                &nbsp;<span onclick="SetNewInputGallery()" class="text-success"uk-icon="add-circle-outline"></span>
                &nbsp;<span onclick="RemoveInputGallery()" class="text-danger" uk-icon="remove-circle-outline"></span>

                <ol id="GalleryPanel">

                </ol>

            </div>
            <div class="card-footer bg-white">
                <button type="submit" class="btn btn-success btn-sm text-white pull-right ml-4">افزودن<span class="icon-holder uk-margin-small-right" uk-icon="add-circle-outline"></span></button>
            </div>
        </form>
    </div>
</div>


@section Script{
    <script src="~/js/bootstrap-tagsinput.js"></script>
    <script src="~/Validate/jquery.validate.min.js"></script>
    <script src="~/Validate/jquery.validate.unobtrusive.js"></script>
    <style>
        .dz-error-message {
            display: none !important;
        }
    </style>
    <script>

        function SetNewInputGallery() {
            $("#GalleryPanel").append("<li><input type='file' name='GalleryFile'/></i>");
        }

        function RemoveInputGallery() {
            $("#GalleryPanel li").last().remove();
        }
      
        $(function () {
            $('#DescriptionShortHtml').ckeditor();
            $('#DescriptionLongHtml').ckeditor();
        });

        function SelectCatagory(Id) {
            $(".Cat").css('color', '');
            $(".Cat").css('font-weight', 'normal');
            $("#Cat-" + Id).css('color', '#3E9731');
            $("#Cat-" + Id).css('font-weight', 'bold');
            $("#CatagoryId").val(Id);
        };

        $("#SubmitColor").click(function () {
            var Color = $("#InputColor").val();
            var Name = $("#InputColorName").val();
            var Count = $("#InputColorCount").val();
            if (Color == null || Color == "" || Name == null || Name == "" || Count == null || Count == "") {
                $("#TblColor").html("همه موارد برای ثبت رنگ الزامی میباشد");
            } else {
                $("#TblColor").html("");
                $("#InputColor").val("");
                $("#InputColorName").val("");
                $("#InputColorCount").val("");
                $("#ColorPanel").html(
                    $("#ColorPanel").html() +
                    "<div onclick='RemoveColorPat(this)' class='form-row'><label class='mr-2'>رنگ :" + Name + "</label><div class='uk-border-rounded mr-2 color-box' style='background:" + Color + ";'></div><label class='mr-2'>" + Count + " عدد</label><input type='hidden' name='Colors' value='" + Color + "' /><input type='hidden' name='ColorsCounts' value='" + Count + "' /><span class='text-danger'>&nbsp;(x)</span></div>"
                );
            }
        });

        function RemoveColorPat(par) {
            par.parentElement.removeChild(par)
        }

        function CreatePropery() {
            var Name = $("#NewProperyName").val();
            if (Name == "" || Name == null) {
                $("#CreateNewProperyErorr").html("لطفا نام ویژگی را وارد کنید");
            } else {
                $.post("/Admin/Property/Create?Name=" + Name, function (result) {
                    if (result == "true") {
                        $("#CreateNewProperyErorr").html("");
                        $("#PropertyPanel").html("");
                        $("#NewProperyName").val("");
                        $.get("/Admin/Product/ProperyList", function (result) {
                            $("#PropertyPanel").html(result);
                        });
                    } else {
                        $("#CreateNewProperyErorr").html(result);
                    }
                });
            }
        }
    </script>
}